<!-- templates/ver_examen.html -->

{% extends "base.html" %}

{% block title %}{{ examen.titulo }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4"><i class="fas fa-file-alt"></i> {{ examen.titulo }}</h2>
    <p class="lead">{{ examen.descripcion }}</p>
    <p><strong>Fecha de Publicación:</strong> {{ examen.fecha_publicacion.strftime('%Y-%m-%d %H:%M') }}</p>
    <p><strong>Fecha de Cierre:</strong> {{ examen.fecha_cierre.strftime('%Y-%m-%d %H:%M') }}</p>

    <hr>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Preguntas</h4>
        <a href="{{ url_for('agregar_pregunta', examen_id=examen.id) }}" class="btn btn-success">
            <i class="fas fa-plus-circle"></i> Agregar Pregunta
        </a>
    </div>

    {% if examen.preguntas %}
        {% for pregunta in examen.preguntas %}
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Pregunta {{ loop.index }} ({{ pregunta.puntaje_total }} puntos)</h5>
                    <p class="card-text">{{ pregunta.enunciado }}</p>
                    <p><strong>Lenguaje de Programación:</strong> {{ pregunta.lenguaje_programacion }}</p>
                    
                    <h6>Casos de Prueba</h6>
                    {% if pregunta.casos_de_prueba %}
                        <ul class="list-group mb-3">
                            {% for caso in pregunta.casos_de_prueba %}
                                <li class="list-group-item">
                                    <strong>Entrada:</strong> {{ caso.entrada }}<br>
                                    <strong>Salida Esperada:</strong> {{ caso.salida_esperada }}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No hay casos de prueba agregados aún.</p>
                    {% endif %}
                    
                    <div class="d-flex justify-content-end">
                        <a href="{{ url_for('editar_pregunta', pregunta_id=pregunta.id) }}" class="btn btn-sm btn-warning me-2">
                            <i class="fas fa-edit"></i> Editar
                        </a>
                        <form action="{{ url_for('eliminar_pregunta', pregunta_id=pregunta.id) }}" method="POST" style="display: inline-block;">
                            {{ form.hidden_tag() }} <!-- Incluir el CSRF token -->
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('¿Estás seguro de eliminar esta pregunta?');">
                                <i class="fas fa-trash-alt"></i> Eliminar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No hay preguntas agregadas aún.</p>
    {% endif %}

    <a href="{{ url_for('gestionar_examenes') }}" class="btn btn-primary mt-3">
        <i class="fas fa-arrow-left"></i> Volver a Gestionar Exámenes
    </a>
</div>
{% endblock %}
