<!-- templates/ver_examen_alumno.html -->

{% extends "base.html" %}

{% block title %}
Detalles del Examen
{% endblock %}


{% block content %}

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0 h4">{{ examen.titulo }}</h2>
        </div>
        <div class="card-body">
            <p><strong>Descripción:</strong><br>{{ examen.descripcion }}</p>
            <p>
                <strong>Fecha de Publicación:</strong> {{ examen.fecha_publicacion.strftime('%Y-%m-%d %H:%M') }}<br>
                <strong>Fecha de Cierre:</strong> {{ examen.fecha_cierre.strftime('%Y-%m-%d %H:%M') }}
            </p>
        </div>
    </div>
    <hr>
    <h4 class="mt-4 mb-3">Preguntas:</h4>
    {% if examen.preguntas %}
        {% for pregunta in examen.preguntas %}
            <div class="card mb-4 shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">Pregunta {{ loop.index }}</h5>
                </div>
                <div class="card-body">
                    <div class="enunciado-contenido mb-3">
                        {# Aquí está la corrección clave: usar el filtro |safe #}
                        {{ pregunta.enunciado | safe }}
                    </div>
                    <hr>
                    <p class="mb-1"><strong>Puntaje Total:</strong> {{ pregunta.puntaje_total }}</p>
                    <p class="mb-3"><strong>Lenguaje de Programación:</strong> {{ pregunta.lenguaje_programacion }}</p>
                    
                    {% if now < examen.fecha_cierre %}
                        <a href="{{ url_for('responder_pregunta', pregunta_id=pregunta.id) }}" class="btn btn-success">
                            <i class="fas fa-pencil-alt"></i> Responder Pregunta
                        </a>
                    {% else %}
                        <button class="btn btn-secondary" disabled>
                            <i class="fas fa-lock"></i> Examen Cerrado
                        </button>
                    {% endif %}
                    
                    {# Opcional: Mostrar enlace a resultados si ya ha entregado y hay evaluación #}
                    {# Necesitarías una lógica para encontrar la entrega/evaluación del current_user para esta pregunta #}
                    {# {% set mi_entrega = obtener_mi_entrega_para_pregunta(current_user.id, pregunta.id) %} #}
                    {# {% if mi_entrega and mi_entrega.evaluacion %}
                        <a href="{{ url_for('ver_resultado', entrega_id=mi_entrega.id) }}" class="btn btn-info ms-2">
                            <i class="fas fa-eye"></i> Ver Mi Resultado
                        </a>
                    {% endif %} #}

                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info">
            Este examen aún no tiene preguntas.
        </div>
    {% endif %}
</div>

{% endblock %}